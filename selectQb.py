from jellyFinbase import *
import qbittorrentapi
qb_host='https://192.168.1.3:8082'
username='yourname'
password = 'yourpassword'
my_qbt = qbittorrentapi.Client(qb_host, username, password)


def getNumber(filepath, absolute_path=False):
    # if 'jukujo' in filepath:
    #   filename = str(re.sub("\[\d{4}-\d{1,2}-\d{1,2}\] - ", "", filepath))
    #   return filename.replace('./','')
    if absolute_path == True:
        filepath = filepath.replace('\\', '/')
        file_number = str(
            re.findall(r'(.+?)\.', str(re.search('([^<>/\\\\|:""\\*\\?]+)\\.\\w+$', filepath).group()))).strip(
            "['']").replace('_', '-')
        return file_number
    if 'jukujo' in filepath:
        file_number = re.search(r'\w+-\w+', filepath.lower().replace('_', '-').replace('-club', ''), re.A).group()
        return file_number
    if 'heydouga' in filepath.lower():
        if 'ppv' in filepath.lower():
            file_number = re.search(r'\d{4}-PPV\d{2,4}', filepath, re.A).group()
        else:
            fp = filepath.replace('_', '-')
            file_number = re.search(r'\d{4}-\d{2,4}', fp, re.A).group()
        return file_number
    if '-' in filepath or '_' in filepath:  # 普通提取番号 主要处理包含减号-和_的番号
        # filepath = filepath.replace("_", "-")
        filepath.strip('22-sht.me').strip('-HD').strip('-hd')
        filename = str(re.sub("\[\d{4}-\d{1,2}-\d{1,2}\] - ", "", filepath))  # 去除文件名中时间
        if 'FC2' or 'fc2' in filename:
            filename = filename.replace('-PPV', '').replace('PPV-', '').replace('FC2PPV-', 'FC2-').replace('FC2PPV_',
                                                                                                           'FC2-')
        # file_number = re.search(r'\w+-\w+', filename, re.A).group() #org
        if re.search(r"\d{5,6}.\d{2,3}",
                     filename) and 'h0930' not in filename.lower() and 'h4610' not in filename.lower() and 'c0930' not in filename.lower():
            file_number = re.search(r'\d{5,6}.\d{2,3}', filename, re.A).group()
        else:
            file_number = re.search(r'\w+-\w+', filename.replace('_', '-'), re.A).group()
        return file_number
    else:  # 提取不含减号-的番号，FANZA CID
        try:
            return str(
                re.findall(r'(.+?)\.', str(re.search('([^<>/\\\\|:""\\*\\?]+)\\.\\w+$', filepath).group()))).strip(
                "['']")  # .replace('_', '-')
        except:
            return re.search(r'(.+?)\.', filepath)[0]


def select_torrent(_hash, _file=None):
    files = my_qbt.torrents_files(hash=_hash)
    # print(files)
    for _file in files:
        _file_name = _file.get('name')
        number = getNumber(_file_name.split('/')[-1])
        _id=_file.get('id')
        if not searchIfExistsInServer(number):
            print(_file_name+'加入下载。')
            my_qbt.torrents_filePrio(_hash, _file.get('id'), 6)
        else:
            my_qbt.torrents_filePrio(_hash, _file.get('id'), 0)


if __name__ == '__main__':
    # with open('1pon.txt') as f:
    #     _list = f.readlines()
    # _list=['010111_352','010112_573','010113_797','010114_004','010115_172','010116_332','010213_798','010214_005','010216_333','010312_575','010313_799','010314_006','010315_173','010411_353','010412_576','010413_800','010414_007','010511_354','010512_577','010513_801','010516_334','010611_355','010612_578','010613_802','010615_174','010711_356','010712_579','010714_008','010716_335','010811_357','010813_803','010815_175','010914_009','010916_336','011013_804','011015_176','011111_358','011112_581','011113_805','011114_010','011213_806','011216_337','011311_360','011312_583','011313_807','011315_177','011411_361','011411_362','011414_011','011416_338','011515_178','011614_012','011616_339','011713_808','011715_179','011813_809','011814_013','011911_363','011912_586','011913_810','011916_340','012011_364','012015_180','012112_588','012113_811','012114_014','012116_341','012211_366','012215_181','012314_015','012316_342','012413_812','012414_016','012415_182','012513_813','012514_017','012611_367','012613_814','012616_343','012711_368','012712_591','012715_183','012811_369','012814_018','012816_344','012913_815','012915_184','013014_019','013016_345','013113_816','013115_185','020112_593','020113_817','020114_020','020212_594','020213_818','020216_346','020312_595','020315_187','020412_596','020414_021','020416_347','020511_374','020513_819','020515_188','020614_022','020616_348','020713_820','020715_189','020812_597','020813_821','020814_023','020911_375','020912_598','020913_822','020915_190','020916_349','021111_377','021112_600','021114_024','021115_191','021116_350','021211_378','021213_823','021314_025','021315_192','021316_351','021413_824','021511_379','021513_825','021514_026','021612_602','021613_826','021615_193','021616_353','021712_603','021812_604','021814_027','021815_194','021816_354','021913_827','022014_028','022015_195','022016_355','022113_828','022212_605','022213_829','022214_029','022311_384','022312_606','022313_830','022315_196','022316_356','022412_607','022511_386','022514_030','022515_197','022516_357','022611_387','022613_831','022714_031','022716_358','022813_832','022815_198','022912_609','030113_833','030114_032','030116_359','030211_388','030213_834','030311_389','030312_612','030315_199','030316_360','030411_390','030414_033','030511_391','030513_835','030515_200','030516_361','030614_034','030712_613','030713_836','030715_201','030812_614','030813_837','030814_035','030816_367','030911_392','030912_615','030913_838','031012_616','031015_202','031016_363','031111_394','031114_036','031211_395','031213_839','031215_203','031216_364','031314_037','031412_617','031413_840','031415_204','031513_841','031514_038','031516_365','031611_396','031612_619','031613_842','031715_205','031716_366','031811_398','031811_399','031814_039','031913_843','031915_206','031916_362','032011_400','032014_040','032016_368','032113_844','032115_207','032116_369','032213_845','032214_041','032216_370','032312_623','032313_846','032415_208','032416_371','032512_624','032514_042','032611_404','032613_847','032615_209','032616_372','032714_043','032813_848','032815_210','032913_849','032914_044','032916_373','033012_627','033013_850','033112_628','033115_211','033116_374','040111_407','040114_045','040211_408','040213_851','040215_212','040216_375','040314_046','040314_047','040412_629','040413_852','040415_213','040513_853','040514_048','040516_376','040611_409','040612_631','040613_854','040715_214','040716_377','040811_411','040814_049','040911_412','040913_855','040915_215','040916_378','041014_050','041112_633','041113_856','041115_215','041212_634','041213_857','041214_051','041216_379','041311_413','041312_635','041313_858','041411_414','041412_636','041415_216','041416_380','041514_052','041611_416','041613_859','041615_217','041616_381','041714_053','041812_637','041813_860','041815_218','041913_861','041914_054','041916_382','042012_639','042013_862','042111_418','042112_640','042115_219','042116_383','042214_055','042313_863','042315_220','042316_384','042414_056','042512_641','042513_864','042515_221','042612_642','042613_865','042614_057','042616_385','042712_643','042713_866','042811_422','042812_644','042815_222','042816_386','042911_423','042912_645','042914_058','043013_867','043015_223','043016_387','050112_646','050114_059','050212_647','050213_868','050311_425','050312_648','050313_869','050314_060','050411_426','050412_649','050413_870','050511_427','050512_650','050611_428','050612_651','050614_061','050616_388','050711_429','050713_871','050811_430','050814_062','050816_389','050913_872','050915_227','051012_654','051013_873','051014_063','051111_431','051112_655','051113_874','051212_656','051215_228','051311_432','051314_064','051316_392','051413_875','051415_229','051512_657','051514_065','051516_390','051613_876','051615_230','051616_391','051712_658','051713_877','051714_066','051811_434','051812_659','051813_878','051912_660','051912_661','051915_231','051916_393','052011_436','052014_067','052113_879','052115_232','052116_395','052212_662','052214_068','052216_394','052313_880','052315_233','052412_663','052413_881','052414_069','052511_438','052512_664','052513_882','052611_439','052612_665','052612_666','052615_234','052616_398','052711_440','052714_070','052813_883','052815_235','052816_396','052912_667','052914_071','052916_397','053013_884','053015_236','053016_399','053112_668','053113_885','053114_072','060111_442','060112_669','060113_886','060211_443','060212_670','060215_237','060216_400','060216_401','060311_444','060314_073','060411_445','060412_671','060413_887','060415_238','060512_672','060514_074','060516_402','060613_888','060615_239','060713_889','060714_075','060812_675','060813_890','060911_447','060912_676','060915_240','060916_403','061011_448','061014_076','061016_404','061111_449','061112_677','061113_891','061115_241','061116_405','061212_678','061214_077','061216_406','061313_892','061315_242','061412_679','061413_893','061414_078','061511_450','061512_680','061513_894','061611_451','061612_681','061615_243','061616_407','061616_408','061711_452','061714_079','061810_238','061811_453','061813_895','061815_244','061912_682','061914_080','062013_896','062015_245','062112_683','062113_897','062114_081','062211_454','062212_684','062213_898','062311_455','062312_685','062315_246','062316_411','062410_241','062414_082','062416_409','062510_242','062511_457','062511_458','062513_899','062515_247','062612_686','062614_083','062616_412','062713_900','062715_248','062716_417','062812_687','062813_901','062814_084','062910_244','062911_459','062912_688','062913_902','063011_460','063012_689','063015_249','070111_461','070114_085','070114_092','070116_413','070116_418','070210_246','070213_903','070214_086','070215_250','070312_690','070314_087','070316_414','070412_691','070413_904','070413_905','070414_088','070415_251','070514_089','070611_463','070612_692','070613_906','070614_090','070711_464','070712_693','070714_091','070715_252','070716_415','070814_093','070816_416','070910_250','070911_466','070913_907','070915_253','070916_419','071010_251','071012_694','071013_908','071014_094','071016_420','071113_909','071115_254','071211_467','071212_695','071213_910','071214_095','071312_696','071313_911','071411_468','071412_697','071415_255','071416_421','071416_422','071510_253','071514_096','071516_423','071610_254','071613_912','071615_256','071710_255','071714_097','071813_913','071815_257','071912_699','071913_914','071914_098','072012_700','072013_915','072110_256','072112_701','072115_258','072210_257','072214_099','072216_425','072313_916','072315_259','072316_424','072410_259','072412_702','072414_100','072416_426','072416_427','072513_917','072515_260','072516_410','072612_703','072613_918','072614_101','072712_704','072713_919','072811_477','072812_705','072815_261','072914_102','072916_428','073011_479','073013_920','073015_262','073016_430','073112_706','073114_103','073116_429','080113_921','080115_263','080212_707','080213_922','080214_104','080312_708','080313_923','080411_481','080412_709','080415_264','080416_432','080511_482','080514_105','080613_924','080615_265','080712_710','080714_106','080716_433','080813_925','080814_107','080815_266','080816_431','080912_711','080913_926','080914_108','081011_484','081012_712','081013_927','081014_109','081111_485','081112_713','081114_110','081115_267','081210_269','081214_111','081216_436','081310_270','081313_928','081314_112','081315_268','081316_435','081410_271','081411_488','081412_714','081414_113','081414_114','081416_434','081512_715','081513_929','081514_115','081515_269','081516_437','081612_716','081613_930','081614_116','081712_717','081713_931','081810_272','081811_490','081812_718','081815_270','081911_491','081914_117','082011_492','082013_932','082015_271','082111_493','082112_719','082114_118','082213_933','082215_272','082312_720','082313_934','082314_119','082410_276','082412_721','082413_935','082512_722','082515_273','082610_277','082611_496','082614_120','082710_278','082711_497','082713_936','082715_274','082812_723','082814_121','082913_937','082915_275','083012_724','083013_938','083014_122','083111_498','083112_725','083113_939','090110_280','090112_726','090115_276','090210_281','090211_500','090214_123','090310_282','090311_501','090313_940','090315_277','090410_283','090411_502','090412_727','090414_124','090513_941','090514_125','090515_278','090611_503','090612_728','090613_942','090710_284','090712_729','090713_943','090811_504','090812_730','090815_279','090910_285','090911_505','090914_126','091010_286','091011_506','091013_944','091015_280','091110_287','091112_731','091114_127','091213_945','091215_281','091312_732','091313_946','091314_128','091412_733','091413_947','091511_508','091512_734','091515_282','091611_509','091614_129','091711_510','091711_511','091713_948','091715_283','091810_291','091812_735','091814_130','091913_949','091915_284','092012_736','092013_950','092014_131','092015_285','092112_737','092113_951','092115_286','092211_513','092212_738','092215_287','092310_293','092314_132','092315_288','092411_515','092413_952','092414_133','092415_289','092512_739','092514_134','092613_953','092615_290','092713_954','092714_135','092812_741','092813_955','092910_296','092912_742','092915_291','093011_519','093014_136','100111_520','100113_956','100115_292','100210_299','100212_743','100214_137','100313_957','100315_293','100412_744','100413_958','100414_138','100511_521','100512_745','100513_959','100610_300','100611_522','100612_746','100615_294','100710_301','100714_139','100811_524','100813_960','100815_295','100910_303','100912_747','100914_140','101013_961','101015_296','101112_748','101113_962','101114_141','101211_525','101212_749','101213_963','101310_304','101311_526','101312_750','101315_297','101410_305','101414_142','101511_528','101513_964','101515_298','101610_306','101612_751','101614_143','101713_965','101715_299','101812_752','101814_144','101911_529','101912_753','101913_966','102010_307','102011_530','102012_754','102015_300','102110_308','102111_531','102114_145','102210_309','102211_532','102213_968','102215_301','102310_310','102312_755','102314_146','102413_969','102415_302','102512_756','102514_147','102612_757','102613_970','102711_534','102712_758','102715_303','102811_535','102814_148','102911_536','102913_971','102915_304','103012_759','103014_149','103113_972','103115_305','110112_760','110113_973','110114_150','110211_537','110212_761','110213_974','110310_315','110311_538','110312_762','110313_975','110314_151','110315_306','110410_316','110510_317','110511_540','110513_976','110515_307','110610_318','110612_763','110614_152','110713_977','110715_308','110812_764','110813_978','110814_153','110911_541','110912_765','110913_979','111010_319','111012_766','111015_309','111111_543','111114_154','111211_544','111213_980','111215_310','111312_767','111314_155','111413_981','111415_311','111512_768','111514_156','111611_545','111612_769','111613_982','111710_323','111711_546','111712_770','111715_312','111811_547','111814_157','111910_325','111910_326','111911_548','111913_983','111915_313','112012_771','112014_158','112113_984','112115_314','112212_772','112213_985','112214_159','112311_549','112312_773','112313_986','112411_550','112412_774','112415_315','112511_551','112514_160','112610_329','112611_552','112613_987','112614_161','112615_316','112710_330','112712_775','112813_988','112815_317','112912_776','112913_989','112914_162','113011_553','113012_777','113013_990','120111_554','120112_778','120115_318','120210_332','120211_555','120214_163','120310_333','120311_556','120313_991','120315_319','120412_779','120414_164','120513_992','120515_320','120612_780','120614_165','120711_557','120712_781','120713_993','120810_335','120811_558','120812_782','120815_321','120910_336','120911_559','120914_166','121010_337','121011_560','121013_994','121015_322','121110_338','121112_783','121114_167','121213_995','121215_323','121312_784','121314_164','121411_561','121412_785','121413_996','121511_562','121512_786','121515_324','121610_340','121611_563','121614_165','121711_564','121713_997','121715_325','121810_342','121812_787','121814_166','121915_326','122012_788','122013_998','122014_167','122111_565','122112_789','122113_999','122210_343','122211_566','122215_327','122310_344','122314_168','122413_100','122415_328','122511_569','122512_790','122512_791','122514_169','122612_792','122613_001','122615_329','122712_793','122714_170','122810_348','122812_764','122813_002','122910_349','122911_570','122912_795','122915_330','123010_350','123011_571','123012_796','123014_171','123111_572','123113_003','123115_331'
    #        ]
    # for x in _list:
    #     number = getNumber(x)
    #     # print(number)
    #     if not searchIfExistsInServer(number):
    #         print(x)
    select_torrent('a3c5dfea40b592f3f10ab2d9ac3501019366a7f7')
